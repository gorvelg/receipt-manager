{% extends 'base.html.twig' %}

{% block title %}Accueil{% endblock %}

{% block body %}
    <h1 class="text-text-800 font-medium text-3xl mb-4">Bonjour <span class="capitalize">{{ app.user.username }}</span> ! ðŸ‘‹</h1>
    <a href="{{ path('app_ticket') }}" class="fixed bottom-0 right-0 m-4">
        {% include ('components/button.html.twig') with {text: 'Ajouter un ticket', type: 'primary'} %}
    </a>
    <div class="bubble-infos rounded-md
            {{ total < 0 ? 'bg-red-100 text-red-950 border-red-200' : 'bg-primary-200 text-teal-950'}}
          "
         >
        <p class="p-2">
            {% if total < 0 %}
                Vous devez <span id="total" class="font-bold">{{ total|abs }} â‚¬</span>
            {% else %}
                Remboursement de <span id="total" class="font-bold">{{ total }} â‚¬</span>
            {% endif %}
        </p>

    </div>
    <div class="bg-primary-200 rounded-md py-2 pl-2 my-4">
        <h2 class="text-text-800 font-medium text-2xl mb-4">Mes tickets</h2>
        <div class="w-full text-text-800">
            {% for ticket in tickets %}
                <a href="{{ path('app_ticket', {ticket: ticket.id}) }}">
                    <div class="hover:bg-primary-300 cursor-pointer grid grid-cols-5 items-center" id="ticket-{{ ticket.id }}" data-url="{{ path('app_ticket', {'ticket': ticket.id}) }}">
                        <div class="gap-2 py-1 flex items-center truncate max-w-20 before:block before:content-[''] before:w-[3px] before:h-10 before:bg-{{ ticket.user.color }}">{{ ticket.title }}</div>
                        <div class="px-2 py-1 truncate">{{ ticket.amount }} â‚¬</div>
                        <div class="px-2 py-1 truncate">{{ ticket.createdAt|date('d/m/Y') }}</div>
                        <div class="px-2 py-1 truncate">{{ ticket.user.username }}</div>
                        <div class="px-2 py-1 truncate">
                            <button class="delete animate-[wiggle_1s_ease-in-out_infinite] hidden" data-ticket-id="{{ ticket.id }}">{% include ('@icons/trash.svg') %}</button>
                        </div>
                    </div>
                </a>
            {% endfor %}
        </div>
    </div>
    {% if tickets %}
        {% include('components/button.html.twig') with {text: 'Supprimer', type: 'primary', id: 'show-delete'} %}
    {% endif %}

    <script>
        const deleteButtons = document.querySelectorAll('.delete');
        const showDelete = document.getElementById('show-delete');

        showDelete.addEventListener('click', () => {
            deleteButtons.forEach(button => {
                button.classList.toggle('hidden');
            });
        });

    </script>

    <style>
        tr:before, tr:before{
            content: '';
            height: 40px;
            width: 3px;
            display: block;
        }
        tr:before{
            background-color: var(--bg-color);
        }
        .bubble-infos:before{
            background-color: var(--bg-color);
        }
    </style>

{% endblock %}

